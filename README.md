# Инструкция по установке и использованию WireGuard с Telegram-ботом

## Введение

Этот документ поможет вам настроить VPN-сервер WireGuard с возможностью управления через Telegram-бота. Бот позволяет легко создавать и удалять клиентские конфигурации (пиры), а также получать QR-коды для быстрого подключения с мобильных устройств.

## Предварительные требования

- Сервер с Debian 12 (или другой Linux-системой)
- Права суперпользователя (root)
- Открытый порт UDP (по умолчанию 51820)
- Доступ к интернету для установки пакетов

## Шаг 1: Получение токена Telegram-бота

Для работы Telegram-бота вам нужен токен, который выдается при создании нового бота:

1. Откройте Telegram и найдите бота **@BotFather**
2. Отправьте команду `/newbot`
3. Следуйте инструкциям, введите имя бота и его username (должен заканчиваться на "bot")
4. После создания бота вы получите токен - скопируйте его для дальнейшего использования
5. Рекомендуется также настроить приватность бота с помощью `/setprivacy`

## Шаг 2: Получение ID администратора

Бот будет принимать команды только от указанных администраторов. Чтобы узнать свой ID:

1. Найдите и напишите боту **@userinfobot** в Telegram
2. Бот автоматически ответит вам, указав ваш Telegram ID (это число)
3. Запишите этот ID - он понадобится при настройке

## Шаг 3: Установка Git и клонирование репозитория

1. Обновите список пакетов и установите Git:
   ```bash
   sudo apt update
   sudo apt install -y git
   ```

2. Клонируйте репозиторий с установочными скриптами:
   ```bash
   git clone https://github.com/FrankX3M/wglite2_tg.git
   cd wglite2_tg
   ```

## Шаг 4: Настройка файла конфигурации

1. Переименуйте пример файла конфигурации:
   ```bash
   cp evn .env
   ```

2. Отредактируйте файл `.env`:
   ```bash
   nano .env
   ```

3. Обязательно заполните следующие параметры:
   - `WG_SERVER_URL` - укажите внешний IP-адрес или домен вашего сервера
   - `TELEGRAM_BOT_TOKEN` - вставьте токен, полученный от @BotFather
   - `TELEGRAM_ADMIN_IDS` - вставьте ваш ID, полученный от @userinfobot

   Пример заполненного файла:
   ```ini
   # Конфигурация директорий
   # необходимо перемиеновать файл в .env 

   # ----------- заполнить -----------
   # Оставьте пустым для автоопределения или укажите ваш домен/IP
   WG_SERVER_URL=123.456.789.123
   # Получите токен у @BotFather
   TELEGRAM_BOT_TOKEN=1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ
   # Укажите ID администраторов через запятую (узнать ID можно у @userinfobot)
   TELEGRAM_ADMIN_IDS=123456789

   # -------------Оставить как есть--------------
   BASE_DIR=/opt/wireguard
   WG_CONFIG_DIR=/opt/wireguard/config
   WG_COMPOSE_DIR=/opt/wireguard/compose
   TELEGRAM_SCRIPT_DIR=/opt/wireguard/telegram-bot
   TELEGRAM_LOG_FILE=/var/log/wg-telegram-bot.log

   # Конфигурация WireGuard
   WG_CONTAINER_NAME=wireguard
   WG_PORT=51820
   WG_INTERNAL_SUBNET=10.13.13.0
   ```

## Шаг 5: Запуск установочного скрипта

1. Сделайте скрипт исполняемым:
   ```bash
   chmod +x main.sh
   ```

2. Запустите скрипт с правами root:
   ```bash
   sudo ./main.sh
   ```

3. Дождитесь завершения установки. Скрипт автоматически:
   - Установит необходимые пакеты
   - Настроит WireGuard в Docker
   - Создаст и запустит Telegram-бота
   - Настроит автозапуск при перезагрузке сервера

## Шаг 6: Использование Telegram-бота

После установки найдите вашего бота в Telegram по имени, которое вы задали при создании. Бот поддерживает следующие команды:

- `/start` - Начало работы с ботом
- `/help` - Вывод справки и списка доступных команд
- `/create имя` - Создать новый пир (клиент) с указанным именем
- `/list` - Показать список всех созданных пиров
- `/show имя` - Показать конфигурацию и QR-код для указанного пира
- `/delete имя` - Удалить указанный пир

### Примеры использования бота:

1. **Создание нового клиента для смартфона**:
   ```
   /create myphone
   ```
   Бот создаст конфигурацию и отправит вам QR-код и файл конфигурации.

2. **Просмотр всех созданных клиентов**:
   ```
   /list
   ```
   Бот покажет список всех созданных пиров.

3. **Получение конфигурации существующего клиента**:
   ```
   /show mylaptop
   ```
   Бот отправит вам QR-код и файл конфигурации для указанного пира.

4. **Удаление клиента**:
   ```
   /delete olddevice
   ```
   Бот удалит пир и соответствующие конфигурации.

## Подключение клиентов

### На Android:

1. Установите приложение "WireGuard" из Google Play
2. Откройте приложение и нажмите "+"
3. Выберите "Сканировать QR-код"
4. Отсканируйте QR-код, полученный от бота
5. Нажмите "Создать туннель"

### На iOS:

1. Установите приложение "WireGuard" из App Store
2. Откройте приложение и нажмите "+"
3. Выберите "Создать из QR-кода"
4. Отсканируйте QR-код, полученный от бота
5. Нажмите "Добавить туннель"

### На Windows:

1. Установите приложение "WireGuard" с официального сайта
2. Нажмите "Добавить туннель"
3. Импортируйте конфигурационный файл, полученный от бота
4. Нажмите "Активировать"

### На Linux:

1. Установите WireGuard: `sudo apt install wireguard`
2. Сохраните конфигурационный файл, полученный от бота, в `/etc/wireguard/wg0.conf`
3. Запустите соединение: `sudo wg-quick up wg0`

## Диагностика и устранение проблем

### Проверка статуса WireGuard:

```bash
docker ps | grep wireguard
```

### Проверка статуса Telegram-бота:

```bash
systemctl status wg-telegram-bot.service
```

### Просмотр логов WireGuard:

```bash
docker logs wireguard
```

### Просмотр логов Telegram-бота:

```bash
cat /var/log/wg-telegram-bot.log
```

### Перезапуск сервисов:

```bash
# Перезапуск WireGuard
cd /opt/wireguard/compose && docker compose restart

# Перезапуск Telegram-бота
systemctl restart wg-telegram-bot.service
```

## Обновление репозитория и конфигурации

Если вышла новая версия скриптов, обновите репозиторий:

1. Перейдите в директорию с репозиторием:
   ```bash
   cd wireguard-telegram-bot
   ```

2. Получите последние изменения:
   ```bash
   git pull
   ```

3. Если нужно изменить настройки, отредактируйте файл `.env`

4. Запустите скрипт установки снова для применения изменений:
   ```bash
   sudo ./main.sh
   ```

## Безопасность

- Доступ к боту ограничен только указанными администраторами
- Все соединения WireGuard шифруются
- Используйте сложные пароли для сервера
- Регулярно обновляйте систему и репозиторий с скриптами

## Дополнительная информация

- WireGuard работает на порту UDP 51820 (если не изменен в настройках)
- Все конфигурации хранятся в директории `/opt/wireguard/config`
- Для изменения параметров контейнера отредактируйте `/opt/wireguard/compose/docker-compose.yml`

---

Теперь у вас есть полностью рабочий VPN-сервер WireGuard с удобным управлением через Telegram-бота!
